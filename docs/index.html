<h1>Automated Farming System API</h1>
<p><a href="https://github.com/dderyldowney/afs_fastapi/actions/workflows/afs-testing.yml"><img alt="AFS Testing" src="https://github.com/dderyldowney/afs_fastapi/actions/workflows/afs-testing.yml/badge.svg" /></a></p>
<p><img alt="Automated Farming System API logo" src="resources/static/images/afs_fastapi-logo.jpg" /></p>
<h2>Project Outline</h2>
<h3>1. Project Purpose</h3>
<p>The <a href="https://github.com/dderyldowney/afs_fastapi">AFS-FastAPI Project</a> aims to harness Machine Learning (ML) and robotics to automate essential farming processes, including
operating farm equipment, maintaining soil health, and managing water quality. By integrating data-driven insights with
advanced automation, the project seeks to enhance farming efficiency, sustainability, and productivity.</p>
<p>The system provides a robust set of API interfaces, using <a href="https://fastapi.tiangolo.com">FastAPI</a>, to support diverse
use cases, ranging from controlling robotic devices and physical farm equipment to monitoring environmental factors such
as soil, water, and air quality. The APIs are designed to serve a wide range of consumers, including AI agents managing
autonomous operations and humans overseeing the overall system or specific subsystems.</p>
<hr />
<h3>2. Locating Operational Manuals for Farm Equipment</h3>
<p><strong>Objective:</strong> Identify and utilize online resources that provide operational manuals for farm equipment. These manuals
will guide the adaptation of current robotics to operate agricultural machines for automation purposes.</p>
<p><strong>FarmTractor Class:</strong>
The <code>FarmTractor</code> is a plain Python class used in the project to represent a farm tractor. It includes attributes such as
<code>make</code>, <code>model</code>, <code>year</code>, and <code>manual_url</code> to store the URL of the operational manual for the tractor. This class is used
to demonstrate core equipment behaviors and to provide a structured way to manage tractor data within the system.</p>
<p>API responses that expose tractor state use a dedicated Pydantic model (<code>FarmTractorResponse</code>) to provide a stable, JSON-serializable schema without mixing API concerns into the core class.</p>
<p><strong>FarmTractor Class Attributes:</strong></p>
<p><strong>Core Identification:</strong>
- <code>make</code> (str): The manufacturer of the tractor.
- <code>model</code> (str): The model of the tractor.
- <code>year</code> (int): The year of manufacture.
- <code>manual_url</code> (str | None): URL to the operational manual.</p>
<p><strong>Engine and Basic Controls:</strong>
- <code>engine_on</code> (bool): Whether the engine is currently running.
- <code>speed</code> (int): Current speed in mph.
- <code>gear</code> (int): Current gear (0-10).
- <code>power_takeoff</code> (bool): Whether the PTO is engaged.
- <code>hydraulics</code> (bool): Whether hydraulics are activated.</p>
<p><strong>GPS and Navigation:</strong>
- <code>gps_latitude</code> (float | None): Current GPS latitude coordinate.
- <code>gps_longitude</code> (float | None): Current GPS longitude coordinate.
- <code>auto_steer_enabled</code> (bool): Whether auto-steer is active.
- <code>waypoints</code> (List[Tuple[float, float]]): Navigation waypoints.
- <code>current_heading</code> (float): Current heading in degrees.</p>
<p><strong>Implement Controls:</strong>
- <code>implement_position</code> (ImplementPosition): Current implement position (raised/lowered/transport).
- <code>implement_depth</code> (float): Working depth in inches.
- <code>implement_width</code> (float): Working width in feet.</p>
<p><strong>Field Operations:</strong>
- <code>field_mode</code> (FieldMode): Current field operation mode.
- <code>work_rate</code> (float): Work rate in acres/hour.
- <code>area_covered</code> (float): Total area covered in acres.</p>
<p><strong>Engine and Fuel:</strong>
- <code>fuel_level</code> (float): Fuel level percentage.
- <code>engine_rpm</code> (int): Engine RPM.
- <code>engine_temp</code> (float): Engine temperature in Fahrenheit.</p>
<p><strong>Hydraulics:</strong>
- <code>hydraulic_pressure</code> (float): Hydraulic pressure in PSI.
- <code>hydraulic_flow</code> (float): Hydraulic flow in GPM.</p>
<p><strong>Sensors:</strong>
- <code>wheel_slip</code> (float): Wheel slip percentage.
- <code>ground_speed</code> (float): Ground speed in mph.
- <code>draft_load</code> (float): Draft load in pounds.</p>
<p><strong>Autonomous Features:</strong>
- <code>autonomous_mode</code> (bool): Whether autonomous mode is enabled.
- <code>obstacle_detection</code> (bool): Whether obstacle detection is active.
- <code>emergency_stop_active</code> (bool): Whether emergency stop is active.</p>
<p><strong>Methods:</strong></p>
<p><strong>Engine Controls:</strong>
- <code>start_engine()</code> -&gt; str: Starts the engine.
- <code>stop_engine()</code> -&gt; str: Stops the engine and resets all systems.</p>
<p><strong>Basic Operation:</strong>
- <code>change_gear(gear: int | str)</code> -&gt; str: Changes the gear (0-10).
- <code>accelerate(increase: int)</code> -&gt; str: Increases speed by the specified amount.
- <code>brake(decrease: int)</code> -&gt; str: Decreases speed by the specified amount.</p>
<p><strong>Power Systems:</strong>
- <code>engage_power_takeoff()</code> -&gt; str: Engages the power takeoff.
- <code>disengage_power_takeoff()</code> -&gt; str: Disengages the power takeoff.
- <code>activate_hydraulics()</code> -&gt; str: Activates hydraulic systems.
- <code>deactivate_hydraulics()</code> -&gt; str: Deactivates hydraulic systems.</p>
<p><strong>GPS and Navigation:</strong>
- <code>set_gps_position(latitude: float, longitude: float)</code> -&gt; str: Sets GPS coordinates.
- <code>enable_auto_steer()</code> -&gt; str: Enables GPS auto-steer system.
- <code>disable_auto_steer()</code> -&gt; str: Disables GPS auto-steer system.
- <code>add_waypoint(latitude: float, longitude: float)</code> -&gt; str: Adds navigation waypoint.
- <code>clear_waypoints()</code> -&gt; str: Clears all waypoints.
- <code>set_heading(heading: float)</code> -&gt; str: Sets current heading (0-359 degrees).</p>
<p><strong>Implement Controls:</strong>
- <code>raise_implement()</code> -&gt; str: Raises the attached implement.
- <code>lower_implement(depth: float = 6.0)</code> -&gt; str: Lowers implement to working depth.
- <code>set_transport_position()</code> -&gt; str: Sets implement to transport position.
- <code>set_implement_width(width: float)</code> -&gt; str: Sets working width (0-80 feet).</p>
<p><strong>Field Operations:</strong>
- <code>set_field_mode(mode: FieldMode)</code> -&gt; str: Sets field operation mode.
- <code>start_field_work()</code> -&gt; str: Begins field work operations.
- <code>update_work_progress(distance: float)</code> -&gt; str: Updates work progress tracking.</p>
<p><strong>Autonomous Operations:</strong>
- <code>enable_autonomous_mode()</code> -&gt; str: Enables autonomous operation mode.
- <code>disable_autonomous_mode()</code> -&gt; str: Disables autonomous operation mode.
- <code>emergency_stop()</code> -&gt; str: Triggers emergency stop - halts all operations.
- <code>reset_emergency_stop()</code> -&gt; str: Resets emergency stop condition.</p>
<p><strong>Diagnostic Methods:</strong>
- <code>get_engine_diagnostics()</code> -&gt; Dict[str, float]: Returns engine diagnostic data.
- <code>get_hydraulic_status()</code> -&gt; Dict[str, float]: Returns hydraulic system status.
- <code>get_ground_conditions()</code> -&gt; Dict[str, float]: Returns ground and traction data.</p>
<p><strong>Utility Methods:</strong>
- <code>__str__()</code> -&gt; str: Returns comprehensive string representation.
- <code>to_response(tractor_id: str | None = None)</code> -&gt; FarmTractorResponse: Converts to API response model.</p>
<p><strong>FarmTractorResponse Class Attributes:</strong></p>
<p>The <code>FarmTractorResponse</code> is a Pydantic model used for API responses, containing:</p>
<ul>
<li><code>tractor_id</code> (str | None): Optional tractor identifier.</li>
<li><code>make</code> (str): Manufacturer name.</li>
<li><code>model</code> (str): Model name.</li>
<li><code>year</code> (int): Year of manufacture.</li>
<li><code>manual_url</code> (str | None): URL to operator's manual.</li>
<li><code>engine_on</code> (bool): Engine running status.</li>
<li><code>speed</code> (int): Current speed in mph.</li>
<li><code>gear</code> (int): Current gear (0-10).</li>
<li><code>power_takeoff</code> (bool): PTO engagement status.</li>
<li><code>hydraulics</code> (bool): Hydraulics activation status.</li>
<li><code>gps_latitude</code> (float | None): GPS latitude coordinate.</li>
<li><code>gps_longitude</code> (float | None): GPS longitude coordinate.</li>
<li><code>auto_steer_enabled</code> (bool): Auto-steer status.</li>
<li><code>implement_position</code> (Literal["raised", "lowered", "transport"]): Implement position state.</li>
<li><code>field_mode</code> (Literal["transport", "tillage", "planting", "spraying", "harvesting", "maintenance"]): Current field operation mode.</li>
<li><code>fuel_level</code> (float): Fuel level percentage.</li>
<li><code>engine_rpm</code> (int): Engine RPM.</li>
<li><code>hydraulic_pressure</code> (float): Hydraulic pressure in PSI.</li>
<li><code>status</code> (str): Complete tractor status string.</li>
</ul>
<p><strong>Example Usage:</strong></p>
<pre class="codehilite"><code class="language-python">from afs_fastapi.equipment.farm_tractors import FarmTractor, FieldMode

# Create a new tractor instance
tractor = FarmTractor(
    make=&quot;John Deere&quot;,
    model=&quot;9RX&quot;,
    year=2023,
    manual_url=&quot;https://www.deere.com/en/parts-and-service/manuals-and-training&quot;
)

# Basic tractor information
print(f&quot;Tractor: {tractor.make} {tractor.model} ({tractor.year})&quot;)
print(f&quot;Manual: {tractor.manual_url}&quot;)
print(f&quot;Current status:\n{tractor}&quot;)

# Start the engine and begin operations
tractor.start_engine()
print(&quot;\n--- Engine Started ---&quot;)

# Set up GPS and navigation
tractor.set_gps_position(40.123456, -85.654321)
tractor.enable_auto_steer()
tractor.add_waypoint(40.125000, -85.650000)
tractor.add_waypoint(40.127000, -85.648000)
print(&quot;GPS and auto-steer configured&quot;)

# Configure for field work
tractor.change_gear(3)
tractor.accelerate(12)  # 12 mph working speed
tractor.activate_hydraulics()
tractor.set_implement_width(32.0)  # 32-foot implement
tractor.lower_implement(8.0)  # 8 inches deep
tractor.set_field_mode(FieldMode.TILLAGE)
print(&quot;Configured for tillage operations&quot;)

# Start field work
tractor.start_field_work()
print(f&quot;Work rate: {tractor.work_rate:.1f} acres/hour&quot;)

# Simulate work progress
tractor.update_work_progress(1320)  # Covered 1/4 mile
print(f&quot;Area covered: {tractor.area_covered:.2f} acres&quot;)

# Enable autonomous mode for precision farming
tractor.enable_autonomous_mode()
print(&quot;Autonomous mode active&quot;)

# Get diagnostic information
engine_diagnostics = tractor.get_engine_diagnostics()
hydraulic_status = tractor.get_hydraulic_status()
ground_conditions = tractor.get_ground_conditions()

print(f&quot;\n--- Diagnostics ---&quot;)
print(f&quot;Engine RPM: {engine_diagnostics['rpm']}&quot;)
print(f&quot;Fuel level: {engine_diagnostics['fuel_level']:.1f}%&quot;)
print(f&quot;Hydraulic pressure: {hydraulic_status['pressure']:.0f} PSI&quot;)
print(f&quot;Ground speed: {ground_conditions['ground_speed']:.1f} mph&quot;)
print(f&quot;Wheel slip: {ground_conditions['wheel_slip']:.1f}%&quot;)

# Convert to API response format
response = tractor.to_response(&quot;tractor-001&quot;)
print(f&quot;\n--- API Response ---&quot;)
print(f&quot;Tractor ID: {response.tractor_id}&quot;)
print(f&quot;Field mode: {response.field_mode}&quot;)
print(f&quot;Implement position: {response.implement_position}&quot;)
print(f&quot;Auto-steer enabled: {response.auto_steer_enabled}&quot;)

# Emergency stop if needed
# tractor.emergency_stop()
# print(&quot;Emergency stop activated!&quot;)

# End of field work - transport mode
tractor.raise_implement()
tractor.set_transport_position()
tractor.set_field_mode(FieldMode.TRANSPORT)
tractor.disable_autonomous_mode()
tractor.accelerate(8)  # Increase speed for transport
print(&quot;\n--- Configured for transport ---&quot;)

# Final status
print(f&quot;\nFinal status:\n{tractor}&quot;)

# Stop engine when done
tractor.stop_engine()
print(&quot;Engine stopped - all systems reset&quot;)
</code></pre>

<p><strong>Sources:</strong></p>
<ol>
<li><a href="https://agmanuals.com">AgManuals</a></li>
<li><a href="https://www.caseih.com/en-us/unitedstates/service-support/operators-manuals">Case IH Operator Manuals</a></li>
<li><a href="https://farmmanualsfast.com">Farm Manuals Fast</a></li>
<li><a href="https://www.agcopubs.com">AGCO Technical Publications</a></li>
<li><a href="https://www.deere.com/en/parts-and-service/manuals-and-training">John Deere Manuals and Training</a></li>
<li><a href="https://farming-constructionmanuals.com">Farming and Construction Manuals</a></li>
<li><a href="https://solano-horizonte.com/download-catalogs-and-manuals-of-agricultural-machinery">Solano Horizonte</a></li>
<li><a href="https://forums.yesterdaystractors.com">Yesterday's Tractors Forums</a></li>
<li><a href="https://tractortoolsdirect.com/manuals">Tractor Tools Direct</a></li>
<li><a href="https://www.generalimp.com/manuals">General Implement Distributors</a></li>
<li><a href="https://www.tractordata.com">TractorData</a></li>
<li><a href="https://www.tractor-manuals-downunder.com">Tractor Manuals Downunder</a></li>
</ol>
<hr />
<p><strong>Build Process:</strong></p>
<p>To build the project, follow these steps:</p>
<ol>
<li>Clone the repository: <code>git clone https://github.com/dderyldowney/afs_fastapi.git</code></li>
<li>Change to the project directory: <code>cd afs_fastapi</code></li>
<li>Create a virtual environment: <code>python -m venv .venv</code></li>
<li>Activate the virtual environment: <code>source .venv/bin/activate</code></li>
<li>Install the project dependencies: <code>pip install -r requirements.txt</code></li>
<li>Install build tools: <code>pip install build</code></li>
<li>Build the project: <code>python -m build</code></li>
<li>Install the generated wheel file: <code>pip install dist/afs_fastapi-0.1.0-py3-none-any.whl</code></li>
<li>Import afs_fastapi into your project: <code>import afs_fastapi</code></li>
</ol>
<p>Note on extras: The project uses <code>fastapi[all]</code> and <code>starlette[full]</code> in development to enable optional features commonly exercised in tests and local runs (e.g., test client utilities, templating, multipart/form-data handling, and uvicorn’s standard extras). This keeps “pip install -r requirements.txt” sufficient for running tests and docs locally.</p>
<hr />
<p><strong>Run the API locally:</strong></p>
<ul>
<li>Quick start (defaults to 127.0.0.1:8000):</li>
<li><code>python -m afs_fastapi</code></li>
<li>or <code>afs-api</code> (installed console script)</li>
<li>Environment overrides:</li>
<li><code>AFS_API_HOST</code> (default: 127.0.0.1)</li>
<li><code>AFS_API_PORT</code> (default: 8000)</li>
<li><code>AFS_API_RELOAD</code> (true/false, default: false)</li>
<li><code>AFS_API_LOG_LEVEL</code> (debug/info/warning/error, default: info)</li>
</ul>
<hr />
<p><strong>Sensor backend interfaces:</strong></p>
<p>Monitoring classes accept pluggable backends so you can swap real sensors without changing API code.</p>
<p>Example (Soil):</p>
<pre class="codehilite"><code class="language-python">from afs_fastapi.monitoring.interfaces import SoilSensorBackend
from afs_fastapi.monitoring.soil_monitor import SoilMonitor

class MySoilBackend(SoilSensorBackend):
    def read(self, sensor_id: str):
        return {&quot;ph&quot;: 6.7, &quot;moisture&quot;: 0.33, &quot;nitrogen&quot;: 1.2, &quot;phosphorus&quot;: 0.5, &quot;potassium&quot;: 0.7}

monitor = SoilMonitor(&quot;SOIL001&quot;, backend=MySoilBackend())
print(monitor.get_soil_composition())
</code></pre>

<p>Example (Water):</p>
<pre class="codehilite"><code class="language-python">from afs_fastapi.monitoring.interfaces import WaterSensorBackend
from afs_fastapi.monitoring.water_monitor import WaterMonitor

class MyWaterBackend(WaterSensorBackend):
    def read(self, sensor_id: str):
        return {&quot;ph&quot;: 7.2, &quot;turbidity&quot;: 1.1, &quot;temperature&quot;: 18.0, &quot;conductivity&quot;: 0.23, &quot;dissolved_oxygen&quot;: 8.0}

monitor = WaterMonitor(&quot;WTR001&quot;, backend=MyWaterBackend())
print(monitor.get_water_quality())
</code></pre>

<hr />
<h3>3. Monitoring and Maintaining Soil Conditions</h3>
<p><strong>Objective:</strong> Research and utilize tools, sensors, and platforms to monitor soil composition, mineral content, and pH
balance, ensuring optimal crop health.</p>
<p><strong>Resources:</strong></p>
<ol>
<li><a href="https://soilscout.com">Soil Scout</a></li>
<li><a href="https://www.renkeer.com/product/soil-nutrient-sensor/">Renke 4-in-1 Soil Nutrient Sensor</a></li>
<li><a href="https://www.murata.com/en-us/products/sensor/soil">Murata Soil Sensors</a></li>
<li><a href="https://www.horiba.com/usa/water-quality/applications/agriculture-crop-science/soil-ph-and-nutrient-availability/">HORIBA LAQUAtwin pH Meters</a></li>
<li><a href="https://www.sensoterra.com/soil-sensor-for-agriculture/">Sensoterra Soil Moisture Sensors</a></li>
<li><a href="https://www.dfrobot.com/product-2830.html">DFRobot 4-in-1 Soil Sensor</a></li>
<li><a href="https://www.earthscout.com/">EarthScout Agricultural Field Sensors</a></li>
<li><a href="https://extension.umn.edu/irrigation/soil-moisture-sensors-irrigation-scheduling">University of Minnesota Extension: Soil Moisture Sensors</a></li>
<li><a href="https://attra.ncat.org/publication/soil-moisture-monitoring-low-cost-tools-and-methods/">ATTRA: Soil Moisture Monitoring Tools</a></li>
<li><a href="https://www.escatec.com/blog/electrochemical-sensors-soil-analysis-through-precision-agriculture">ESCATEC Electrochemical Sensors</a></li>
</ol>
<hr />
<h3>4. Monitoring and Maintaining Water Conditions</h3>
<p><strong>Objective:</strong> Identify and deploy tools to assess and maintain water composition, mineral levels, and pH balance,
ensuring water quality is optimized for agricultural use.</p>
<p><strong>Resources:</strong></p>
<ol>
<li><a href="https://www.renkeer.com/top-7-water-quality-sensors/">Renke Water Quality Sensors</a></li>
<li><a href="https://in-situ.com/us/agriculture">In-Situ Agriculture Water Monitoring</a></li>
<li><a href="https://www.xylemanalytics.com/en/products/water-quality-monitoring">Xylem Analytics Water Quality Monitoring</a></li>
<li><a href="https://ketos.co/">KETOS Automated Water Monitoring</a></li>
<li><a href="https://www.ysi.com/products">YSI Water Quality Systems</a></li>
<li><a href="https://www.sgs.com/en-us/services/agricultural-water-testing">SGS Agricultural Water Testing</a></li>
<li><a href="https://www.boquinstrument.com/how-water-quality-sensors-are-used-in-agriculture-and-farming.html">Boqu Instrument Water Quality Sensors</a></li>
<li><a href="https://sense.digitalmatter.com/blog/water-quality-monitoring">Digital Matter Remote Sensor Solutions</a></li>
<li><a href="https://www.intuz.com/blog/iot-for-water-monitoring-in-crops">Intuz IoT Water Monitoring</a></li>
<li><a href="https://www.rikasensor.com/blog-top-10-water-quality-sensors-for-water-treatments.html">Rika Sensor Water Quality Sensors</a></li>
</ol>
<hr />
<h3>5. Utilizing Publicly Available Water Sampling Datasets</h3>
<p><strong>Objective:</strong> Access and analyze publicly available water quality datasets to inform ML models for monitoring water
conditions suitable for farming.</p>
<p><strong>Sources:</strong></p>
<ol>
<li><a href="https://www.waterqualitydata.us/">Water Quality Portal (WQP)</a></li>
<li><a href="https://catalog.data.gov/dataset">USGS National Water Information System (NWIS)</a></li>
<li><a href="https://www.epa.gov/waterdata/water-quality-data">EPA Water Quality Data</a></li>
<li><a href="https://www.kaggle.com/datasets/abhishekkhanna004/water-quality-dataset-for-crop">Kaggle: Water Quality Dataset for Crop</a></li>
<li><a href="https://agdatacommons.nal.usda.gov/articles/dataset/Soil_and_Water_Hub_Modeling_Datasets/24852681">Ag Data Commons: Soil and Water Hub Modeling</a></li>
<li><a href="https://www.earthdata.nasa.gov/topics/ocean/water-quality">NASA Earthdata: Water Quality</a></li>
</ol>
<hr />
<h3>6. Project Integration and Machine Learning Goals</h3>
<p><strong>Objective:</strong> Synthesize the research and datasets into ML models and robotics systems capable of automating farm
operations, improving efficiency, and ensuring sustainability. Models will address:</p>
<ul>
<li>Autonomous machine operation (leveraging operational manuals).</li>
<li>Soil condition predictions and adjustments.</li>
<li>Water quality monitoring and real-time management.</li>
</ul>
<p><strong>Tools and Techniques:</strong></p>
<ul>
<li>ML libraries like TensorFlow and PyTorch.</li>
<li>IoT-enabled sensors for real-time data collection.</li>
<li>Integration with cloud platforms for data storage and analysis.</li>
</ul>
<hr />
<h3>Conclusion</h3>
<p>This project will employ cutting-edge ML and robotics solutions to automate farming processes, ensuring optimized
resource utilization and sustainable agricultural practices.</p>
<hr />
<h2>Contributing</h2>
<p>See <a href="CONTRIBUTING.md">CONTRIBUTING.md</a> for the Quick Verification Checklist and contribution guidelines.</p>
<hr />
<h2>Security Notes</h2>
<p>This project enables automated checks (Dependabot + pip-audit) for dependency vulnerabilities. Two current advisories are known and monitored:</p>
<ul>
<li>Starlette 0.41.3: GHSA-2c2j-9gv5-cj73 (CVE-2025-54121)</li>
<li>Summary: Large multipart form uploads may block the event loop while rolling files to disk.</li>
<li>Project impact: This API does not use multipart uploads; risk is low in our deployment.</li>
<li>
<p>Remediation: Fixed in Starlette &gt;= 0.47.2. We will upgrade alongside a compatible FastAPI release.</p>
</li>
<li>
<p>h11 0.14.0: GHSA-vqfr-h8mv-ghfj (CVE-2025-43859)</p>
</li>
<li>Summary: Lenient chunked-encoding parsing could enable request smuggling in specific proxy mismatch scenarios.</li>
<li>Project impact: h11 is pulled in via HTTP client tooling (httpx/httpcore) for development; the server stack uses Uvicorn/Starlette. Risk is low in typical deployments, especially behind well-configured reverse proxies.</li>
<li>Remediation: Fixed in h11 &gt;= 0.16.0, which currently conflicts with pinned httpcore. We will bump httpcore/httpx and FastAPI in a coordinated upgrade once compatible.</li>
</ul>
<p>Mitigations in place:
- No multipart endpoints are exposed.
- CI flags vulnerabilities and proposes updates automatically.
- We will track upstream compatibility windows and upgrade as they align.</p>
